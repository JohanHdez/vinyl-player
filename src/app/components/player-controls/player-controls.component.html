<div class="bar-layout" [class.controls-disabled]="controlsDisabled()">
  <!-- Mini vinyl / Thumbnail -->
  <div class="bar-thumb" [class.bar-thumb--playing]="isPlaying()">
    @if (thumbUrl()) {
      <img [src]="thumbUrl()" alt="" class="thumb-img">
      <div class="thumb-vinyl-ring"></div>
    } @else {
      <div class="thumb-placeholder">
        <svg viewBox="0 0 24 24"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55C7.79 13 6 14.79 6 17s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
      </div>
    }
  </div>

  <!-- Song info -->
  <div class="bar-info">
    <div class="song-title">{{ currentSong()?.title || 'Sin reproducir' }}</div>
    <div class="song-artist">{{ currentSong()?.channel || 'Busca una cancion para comenzar' }}</div>
  </div>

  <!-- Main controls -->
  <div class="bar-controls">
    <button class="ctrl-btn" [class.active]="shuffle()" (click)="toggleShuffle()" title="Aleatorio">
      <svg viewBox="0 0 24 24"><path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/></svg>
    </button>
    <button class="ctrl-btn" [disabled]="controlsDisabled()" (click)="prev()" title="Anterior">
      <svg viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg>
    </button>
    <button class="play-btn" [disabled]="controlsDisabled()" (click)="togglePlay()" title="Reproducir">
      <svg viewBox="0 0 24 24">
        @if (isPlaying()) {
          <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
        } @else {
          <path d="M8 5v14l11-7z"/>
        }
      </svg>
    </button>
    <button class="ctrl-btn" [disabled]="controlsDisabled()" (click)="next()" title="Siguiente">
      <svg viewBox="0 0 24 24"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg>
    </button>
    <button class="ctrl-btn" [class.active]="repeat()" (click)="toggleRepeat()" title="Repetir">
      <svg viewBox="0 0 24 24"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg>
    </button>
  </div>

  <!-- Progress -->
  <div class="bar-progress">
    <span class="time-label">{{ formatTime(currentTime()) }}</span>
    <div class="progress-bar"
         [class.disabled]="controlsDisabled()"
         (click)="onProgressClick($event)"
         (mousemove)="onProgressHover($event)"
         (mouseleave)="onProgressLeave()">
      <div class="progress-fill" [style.width.%]="progressPercent()"></div>
      <div class="progress-hover-fill" [style.width.%]="showHoverTooltip() ? hoverPercent() : 0"></div>
      @if (showHoverTooltip() && !controlsDisabled()) {
        <div class="progress-thumb" [style.left.%]="progressPercent()"></div>
        <div class="progress-tooltip" [style.left.%]="hoverPercent()">{{ hoverTime() }}</div>
      }
    </div>
    <span class="time-label">{{ formatTime(duration()) }}</span>
  </div>

  <!-- Volume -->
  <div class="bar-volume">
    <svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg>
    <input type="range" class="volume-slider" [value]="volume()" (input)="onVolumeChange($event)" min="0" max="100">
  </div>
</div>
